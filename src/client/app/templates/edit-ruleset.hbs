<div style="float:none">
	{{#link-to 'rulesets' tagName='button' class='btn btn-success btn-sm btn-return-title'}}
		{{#bs-tooltip placement="left"}}Return to main page{{/bs-tooltip}}
        <i class="fa fa-angle-double-left"></i>
	{{/link-to}}


	<h2>Edit Ruleset {{model.ruleset.filename}}</h2>
	<div class="authDetails">
		<div>Owned by {{ownedBy}}</div>
		<div>Lasted edited on {{lastEdited}} by {{lastEditedBy}}</div>
	</div>


</div>

	<div style="float: left;display:flex;">

		<div style="float:none;">
			<div class="column">

                <div class="section-content">Description: {{input id="rulesetName" type="text"
					value=model.ruleset.name class="text-input" disabled=disableEdit}}
                </div>

                <div class="section-content" id="source">
                    <span class="section-header">Source: </span>
					{{#if model.ruleset.source}}
						{{model.ruleset.source.config.file}} in {{model.source.description}}
					{{else}}
                        None
					{{/if}}

                </div>

				{{#unless model.source.config.linkedtargetid}}

                    <div class="section-content" id="target">
                        <span class="section-header">Target:</span>
                        <!--
						{{#power-select
						search=(action "searchTarget")
						onchange=(action "chooseTarget")
						selected=model.target
						allowClear=true
						as |targetChoice|}}
							{{targetChoice.rule_id}}: {{targetChoice.description}}
						{{/power-select}}
-->
						{{#if model.ruleset.target}}
							{{model.ruleset.target.config.file}} in {{model.target.description}}
						{{else}}
                            None
						{{/if}}

                    </div>
				{{/unless}}

                <div class="section-content rule-selectable" id="parser" {{action "toggleCollapse" "parserCollapse"}}>
                    <span class="section-header">Parser:</span>
					{{#if model.ruleset.parser}}
						{{model.ruleset.parser.filename}}
					{{else}}
                        None
					{{/if}}
					<span>
						{{#if parserCollapse}}
                            <i class="fa fa-caret-square-o-right "></i>
						{{else}}
                            <i class="fa fa-caret-square-o-down"></i>
						{{/if}}

					</span>
					{{#bs-collapse collapsed=parserCollapse}}
						Details:
						{{show-rule-editor ruleInstance=model.ruleset.parser rules=model.rules ruleset=model.ruleset parsers=model.parsers
						importers=model.importers exporters=model.exporters rulesetconfiguis=model.rulesetconfiguis readOnly=disableEdit}}

						{{component 'custom-property.property-list' uiList=(compute (action "getUiProperties") model.parsers model.ruleset.parser.filename) config=model.ruleset.parser.config disabled=disabled}}

					{{/bs-collapse}}
                </div>


				<div class="section-content rule-selectable" id="general" {{action "toggleRowHighlight" "general"
				model.ruleset.general}}>General Configuration</div>







				<div class="section-header">Rules</div>

				{{#bs-accordion as |acc|}}
					{{#each model.ruleset.rules as |ruleInstance index|}}
						{{#acc.item value=index title=ruleInstance.name}}
							<p>Lorem ipsum...</p>
							<button {{action acc.change index}}>Next</button>
						{{/acc.item}}
					{{/each}}
				{{/bs-accordion}}

				<table id="rulesTable" class="ruleset-table">
					{{#each model.ruleset.rules as |ruleInstance index|}}
						<tr
								id="{{concat 'rulesetTableRow' index}}" {{action "toggleRowHighlight"
						(concat 'rulesetTableRow' index)
						ruleInstance}}
								class="rule-selectable">
							<td>{{ruleInstance.name}}</td>
							{{#if (not disableEdit)}}
								<td>
									<button {{action "moveRuleUp" model.ruleset index}}><i class="fa fa-arrow-up"></i>
									</button>
								</td>
								<td>
									<button {{action "moveRuleDown" model.ruleset index}}><i class="fa fa-arrow-down"></i>
									</button>
								</td>
							{{/if}}
						</tr>
					{{/each}}
					{{#if showAddRule}}
						<td>
							<select id="selectRule">
								<option value="None" selected>None</option>
								{{#each model.rules as |rule|}}
									<option value="{{rule.filename}}">{{rule.name}}</option>
								{{/each}}
							</select>
						</td>
						<td>
							<button {{action "hideAddRule"}}>Cancel</button>
							<button {{action "addRule" model.ruleset model.rules}}><i class="fa fa-plus"></i></button>
						</td>
					{{/if}}
				</table>

				{{#if (not disableEdit)}}

						<button class="show-add-rule" style="float: left" {{action "showAddRule"}}><i class="fa fa-plus"></i>
						</button>
						<button class="show-add-rule" style="float: left" {{action "deleteRule" "rulesTable" model.ruleset}}><i
								class="fa fa-trash"></i></button>
						<button class="save-ruleset" style="float: right" {{action "saveRuleSet" model.ruleset}}>Save RuleSet
						</button>

				{{/if}}


			</div>
			<div class="column" style="{{unless this.ruleToEdit 'visibility:hidden' }}">
				<!-- The column for editting rule properties. -->
				{{show-rule-editor ruleInstance=ruleToEdit rules=model.rules ruleset=model.ruleset parsers=model.parsers
				importers=model.importers exporters=model.exporters rulesetconfiguis=model.rulesetconfiguis readOnly=disableEdit}}
				<!--<button class="save-ruleset" style="float: right" {{action "updateRule"
				ruleToEdit}}>Apply</button>-->
			</div>
		</div>
	</div>
	<div class="fileUpload btn btn-default">
		<span>Test Ruleset</span>
		{{file-upload url="/processupload" ruleset=model.ruleset.filename completion=(action "toggleUpload") status=(action "showProcessing")}}
	</div>


{{#if processing}}
    <i class="fa fa-spinner fa-spin fa-3x fa-fw"></i>
    <span>Processing...</span>
{{/if}}
{{#bs-collapse collapsed=collapsedRun}}
	{{outlet}}
{{/bs-collapse}}
